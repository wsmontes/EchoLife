/**
 * Translations for Echo Life App
 * Contains UI text in English and Brazilian Portuguese
 */

const translations = {
    // Header
    'app_title': {
        'en-US': 'Echo Life',
        'pt-BR': 'Echo Life'
    },
    'app_tagline': {
        'en-US': 'Speak and connect with AI',
        'pt-BR': 'Fale e conecte-se com a IA'
    },
    'edit_api_key': {
        'en-US': 'API',
        'pt-BR': 'API'
    },
    
    // Word Cloud
    'words_appear': {
        'en-US': 'Words will appear as you speak...',
        'pt-BR': 'Palavras aparecerão enquanto você fala...'
    },
    
    // Recording
    'click_to_start': {
        'en-US': 'Click to start recording',
        'pt-BR': 'Clique para iniciar a gravação'
    },
    'recording_click_to_stop': {
        'en-US': 'Recording... Click to stop',
        'pt-BR': 'Gravando... Clique para parar'
    },
    'processing': {
        'en-US': 'Processing...',
        'pt-BR': 'Processando...'
    },
    'transcribing': {
        'en-US': 'Transcribing audio...',
        'pt-BR': 'Transcrevendo áudio...'
    },
    'ios_users_note': {
        'en-US': 'iOS users: If recording fails, try the upload option below',
        'pt-BR': 'Usuários de iOS: Se a gravação falhar, tente a opção de upload abaixo'
    },
    
    // Upload
    'upload_audio': {
        'en-US': 'Upload Audio',
        'pt-BR': 'Enviar Áudio'
    },
    'drop_audio': {
        'en-US': 'Drop any audio file here',
        'pt-BR': 'Solte qualquer arquivo de áudio aqui'
    },
    'or': {
        'en-US': 'or',
        'pt-BR': 'ou'
    },
    'click_to_select': {
        'en-US': 'Click to select a file',
        'pt-BR': 'Clique para selecionar um arquivo'
    },
    'supported_formats': {
        'en-US': 'Supported formats: MP3, WAV, M4A, AAC, OPUS, OGG',
        'pt-BR': 'Formatos suportados: MP3, WAV, M4A, AAC, OPUS, OGG'
    },
    'whatsapp_hint': {
        'en-US': 'WhatsApp voice messages are fully supported.',
        'pt-BR': 'Mensagens de voz do WhatsApp são totalmente suportadas.'
    },
    
    // AI Response
    'ai_response': {
        'en-US': 'AI Response',
        'pt-BR': 'Resposta da IA'
    },
    'get_ai_feedback': {
        'en-US': 'Get AI Feedback',
        'pt-BR': 'Obter Feedback da IA'
    },
    
    // Export
    'export_options': {
        'en-US': 'Export Options',
        'pt-BR': 'Opções de Exportação'
    },
    'export_txt': {
        'en-US': 'Export TXT',
        'pt-BR': 'Exportar TXT'
    },
    'export_srt': {
        'en-US': 'Export SRT',
        'pt-BR': 'Exportar SRT'
    },
    'export_audio': {
        'en-US': 'Export Audio',
        'pt-BR': 'Exportar Áudio'
    },
    'export_video': {
        'en-US': 'Export Video+Subs',
        'pt-BR': 'Exportar Vídeo+Legendas'
    },
    
    // Subtitle Preview
    'subtitle_preview': {
        'en-US': 'Subtitle Preview',
        'pt-BR': 'Pré-visualização de Legendas'
    },
    'subtitles_appear': {
        'en-US': 'Subtitles will appear here during playback',
        'pt-BR': 'As legendas aparecerão aqui durante a reprodução'
    },
    'close_preview': {
        'en-US': 'Close Preview',
        'pt-BR': 'Fechar Pré-visualização'
    },
    'preview_subtitles': {
        'en-US': 'Preview with Subtitles',
        'pt-BR': 'Pré-visualizar com Legendas'
    },
    
    // Tags
    'ai_response_tags': {
        'en-US': 'AI Response Tags',
        'pt-BR': 'Tags da Resposta da IA'
    },
    'tags_appear': {
        'en-US': 'Tags from AI responses will appear here',
        'pt-BR': 'Tags das respostas da IA aparecerão aqui'
    },
    
    // Audio History
    'recent_audios': {
        'en-US': 'Recent Audios',
        'pt-BR': 'Áudios Recentes'
    },
    'history_appear': {
        'en-US': 'Your uploaded audio history will appear here',
        'pt-BR': 'Seu histórico de áudios enviados aparecerá aqui'
    },
    'no_response_yet': {
        'en-US': 'No feedback yet',
        'pt-BR': 'Sem feedback ainda'
    },
    
    // Footer
    'copyright': {
        'en-US': 'Echo Life &copy; 2023',
        'pt-BR': 'Echo Life &copy; 2023'
    },
    'test_whisper': {
        'en-US': 'Test Whisper API',
        'pt-BR': 'Testar API Whisper'
    },
    
    // Messages
    'api_key_required': {
        'en-US': 'An OpenAI API key is required to use this application.',
        'pt-BR': 'Uma chave de API da OpenAI é necessária para usar este aplicativo.'
    },
    'enter_api_key': {
        'en-US': 'Please enter your OpenAI API key:',
        'pt-BR': 'Por favor, digite sua chave de API da OpenAI:'
    },
    'enter_new_api_key': {
        'en-US': 'Enter a new OpenAI API key:',
        'pt-BR': 'Digite uma nova chave de API da OpenAI:'
    },
    'api_key_updated': {
        'en-US': 'API key updated successfully.',
        'pt-BR': 'Chave de API atualizada com sucesso.'
    },
    'invalid_api_key': {
        'en-US': 'The API key is invalid or lacks necessary permissions. Please enter a valid API key.',
        'pt-BR': 'A chave de API é inválida ou não possui as permissões necessárias. Por favor, digite uma chave de API válida.'
    },
    'mic_access_denied': {
        'en-US': 'Microphone access denied. Please enable microphone permissions in your browser settings.',
        'pt-BR': 'Acesso ao microfone negado. Por favor, habilite as permissões de microfone nas configurações do seu navegador.'
    },
    'ios_audio_trouble': {
        'en-US': 'Your iOS device is having trouble with audio recording. Try using the audio upload option instead.',
        'pt-BR': 'Seu dispositivo iOS está tendo problemas com a gravação de áudio. Tente usar a opção de upload de áudio.'
    },
    'no_audio_recorded': {
        'en-US': 'No audio recorded. Try again.',
        'pt-BR': 'Nenhum áudio gravado. Tente novamente.'
    },
    'transcription_failed': {
        'en-US': 'Transcription failed. Try using the upload option.',
        'pt-BR': 'Falha na transcrição. Tente usar a opção de upload.'
    },
    'listening': {
        'en-US': 'Listening...',
        'pt-BR': 'Ouvindo...'
    },
    'processing_speech': {
        'en-US': 'Processing...',
        'pt-BR': 'Processando...'
    },
    'error_processing': {
        'en-US': 'Error processing',
        'pt-BR': 'Erro no processamento'
    },
    
    // Video Export
    'export_for_quicktime': {
        'en-US': 'Export for QuickTime Player',
        'pt-BR': 'Exportar para QuickTime Player'
    },
    'apple_format_details': {
        'en-US': 'Format Details',
        'pt-BR': 'Detalhes do Formato'
    },
    'apple_audio_format': {
        'en-US': 'Audio: .m4a format with AAC codec (QuickTime standard)',
        'pt-BR': 'Áudio: formato .m4a com codec AAC (padrão QuickTime)'
    },
    'apple_subtitle_format': {
        'en-US': 'Subtitles: .srt file with identical base name',
        'pt-BR': 'Legendas: arquivo .srt com nome base idêntico'
    },
    'export_for_quicktime_btn': {
        'en-US': 'Export for QuickTime',
        'pt-BR': 'Exportar para QuickTime'
    },
    'cancel': {
        'en-US': 'Cancel',
        'pt-BR': 'Cancelar'
    },
    
    // Translation Toggle
    'translation_enabled_en': {
        'en-US': 'Translate to Portuguese',
        'pt-BR': 'Traduzir para Inglês'
    },
    'translation_disabled_en': {
        'en-US': 'Keep English',
        'pt-BR': 'Manter Português'
    },
    'translation_enabled_pt': {
        'en-US': 'Translate to English',
        'pt-BR': 'Traduzir para Inglês'
    },
    'translation_disabled_pt': {
        'en-US': 'Keep Portuguese',
        'pt-BR': 'Manter Português'
    }
};

// Function to update UI text based on selected language
function updateUILanguage(language) {
    if (!translations) {
        console.error('Translations not loaded');
        return;
    }
    
    // Only proceed with a valid language
    if (language !== 'en-US' && language !== 'pt-BR') {
        console.error('Invalid language:', language);
        return;
    }
    
    // Update document title
    document.title = translations['app_title'][language] + ' - Voice to AI';
    
    // Update app title and tagline
    const appTitle = document.querySelector('header h1');
    const appTagline = document.querySelector('header p');
    
    if (appTitle) appTitle.textContent = translations['app_title'][language];
    if (appTagline) appTagline.textContent = translations['app_tagline'][language];
    
    // Update API key button
    const apiKeyButton = document.getElementById('editApiKeyButton');
    if (apiKeyButton) apiKeyButton.textContent = translations['edit_api_key'][language];
    
    // Update word cloud placeholder
    const wordCloudPlaceholder = document.querySelector('.word-cloud-placeholder');
    if (wordCloudPlaceholder) wordCloudPlaceholder.textContent = translations['words_appear'][language];
    
    // Update recording section
    const recordingStatus = document.getElementById('recordingStatus');
    if (recordingStatus) {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (isIOS) {
            recordingStatus.innerHTML = `${translations['click_to_start'][language]}<br><small>${translations['ios_users_note'][language]}</small>`;
        } else {
            recordingStatus.textContent = translations['click_to_start'][language];
        }
    }
    
    // Update upload section
    const uploadTitle = document.querySelector('.audio-drop-section h2');
    if (uploadTitle) uploadTitle.textContent = translations['upload_audio'][language];
    
    const dropText = document.querySelector('.drop-text');
    if (dropText) {
        dropText.innerHTML = `
            <p>${translations['drop_audio'][language]}</p>
            <p>${translations['or'][language]}</p>
            <p>${translations['click_to_select'][language]}</p>
            <p class="supported-formats">${translations['supported_formats'][language]}</p>
        `;
    }
    
    const whatsappHint = document.querySelector('.whatsapp-hint');
    if (whatsappHint) whatsappHint.textContent = translations['whatsapp_hint'][language];
    
    // Update AI Response section
    const aiResponseTitle = document.querySelector('.chat-section h2');
    if (aiResponseTitle) aiResponseTitle.textContent = translations['ai_response'][language];
    
    const feedbackButton = document.getElementById('feedbackButton');
    if (feedbackButton) feedbackButton.innerHTML = `<i class="fas fa-comment-dots"></i> ${translations['get_ai_feedback'][language]}`;
    
    // Update export section
    const exportTitle = document.querySelector('.export-container h3');
    if (exportTitle) exportTitle.textContent = translations['export_options'][language];
    
    const exportTxtBtn = document.getElementById('exportTxtBtn');
    if (exportTxtBtn) exportTxtBtn.innerHTML = `<i class="fas fa-file-alt"></i> ${translations['export_txt'][language]}`;
    
    const exportSrtBtn = document.getElementById('exportSrtBtn');
    if (exportSrtBtn) exportSrtBtn.innerHTML = `<i class="fas fa-closed-captioning"></i> ${translations['export_srt'][language]}`;
    
    const exportAudioBtn = document.getElementById('exportAudioBtn');
    if (exportAudioBtn) exportAudioBtn.innerHTML = `<i class="fas fa-file-audio"></i> ${translations['export_audio'][language]}`;
    
    const exportVideoBtn = document.getElementById('exportVideoBtn');
    if (exportVideoBtn) exportVideoBtn.innerHTML = `<i class="fas fa-film"></i> ${translations['export_video'][language]}`;
    
    // Update subtitle preview
    const subtitlePreviewTitle = document.querySelector('.subtitle-preview-container h4');
    if (subtitlePreviewTitle) subtitlePreviewTitle.textContent = translations['subtitle_preview'][language];
    
    const subtitleDisplay = document.getElementById('previewSubtitleDisplay');
    if (subtitleDisplay) subtitleDisplay.textContent = translations['subtitles_appear'][language];
    
    const closePreviewBtn = document.getElementById('closePreviewBtn');
    if (closePreviewBtn) closePreviewBtn.innerHTML = `<i class="fas fa-times"></i> ${translations['close_preview'][language]}`;
    
    const previewSubtitlesBtn = document.getElementById('previewSubtitlesBtn');
    if (previewSubtitlesBtn) previewSubtitlesBtn.innerHTML = `<i class="fas fa-play-circle"></i> ${translations['preview_subtitles'][language]}`;
    
    // Update tag section
    const tagSectionTitle = document.querySelector('.tag-section h3');
    if (tagSectionTitle) tagSectionTitle.textContent = translations['ai_response_tags'][language];
    
    const tagPlaceholder = document.querySelector('.tag-placeholder');
    if (tagPlaceholder) tagPlaceholder.textContent = translations['tags_appear'][language];
    
    // Update audio history section
    const historyTitle = document.querySelector('.audio-history-section h2');
    if (historyTitle) historyTitle.textContent = translations['recent_audios'][language];
    
    const emptyHistoryMessage = document.querySelector('.empty-history-message');
    if (emptyHistoryMessage) emptyHistoryMessage.textContent = translations['history_appear'][language];
    
    // Update footer
    const copyright = document.querySelector('footer p');
    if (copyright) copyright.innerHTML = translations['copyright'][language];
    
    const testWhisperButton = document.getElementById('testWhisperButton');
    if (testWhisperButton) testWhisperButton.textContent = translations['test_whisper'][language];
    
    // Update any no-response badges
    const noResponseBadges = document.querySelectorAll('.no-response-badge');
    noResponseBadges.forEach(badge => {
        badge.textContent = translations['no_response_yet'][language];
    });
    
    // Update translation toggle label
    const translationToggleLabel = document.getElementById('translationToggleLabel');
    const translationToggle = document.getElementById('translationToggle');
    
    if (translationToggleLabel && translationToggle) {
        const isEnabled = translationToggle.checked;
        const key = language === 'pt-BR' ? 
            (isEnabled ? 'translation_enabled_pt' : 'translation_disabled_pt') :
            (isEnabled ? 'translation_enabled_en' : 'translation_disabled_en');
            
        translationToggleLabel.textContent = translations[key][language];
    }
    
    // Store selected language in local storage for persistence
    localStorage.setItem('echolife_language', language);
    
    console.log(`UI language updated to: ${language}`);
}

// Initialize language from local storage or browser preference
document.addEventListener('DOMContentLoaded', () => {
    // Look for stored preference first
    let language = localStorage.getItem('echolife_language');
    
    // If no stored preference, use browser language
    if (!language) {
        const browserLang = navigator.language || navigator.userLanguage;
        language = browserLang.startsWith('pt') ? 'pt-BR' : 'en-US'; // Default to en-US if not Portuguese
    }
    
    // Update the language selector UI
    const languageSelector = document.getElementById('languageSelector');
    if (languageSelector) {
        languageSelector.value = language;
    }
    
    // Update the UI with the selected language
    updateUILanguage(language);
});

// Global function to get translated text
function getTranslation(key, language) {
    if (!language) {
        language = localStorage.getItem('echolife_language') || 'en-US';
    }
    
    if (translations[key] && translations[key][language]) {
        return translations[key][language];
    }
    
    // Fallback to English if translation not found
    if (translations[key] && translations[key]['en-US']) {
        console.warn(`Translation missing for key "${key}" in language "${language}". Using English.`);
        return translations[key]['en-US'];
    }
    
    // If key doesn't exist, return the key itself
    console.error(`Translation key "${key}" not found.`);
    return key;
}

// Make translations globally available
window.translations = translations;
window.updateUILanguage = updateUILanguage;
window.getTranslation = getTranslation;
