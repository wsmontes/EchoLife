<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Echo Life - Voice to AI</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/audio-upload.css">
    <link rel="stylesheet" href="css/word-cloud.css">
    <link rel="stylesheet" href="css/tooltip.css">
    <!-- Add MP4Box.js for MP4 container manipulation -->
    <script src="https://cdn.jsdelivr.net/npm/mp4box@0.5.2/dist/mp4box.all.min.js"></script>
    <!-- Add theme-color for PWA capabilities -->
    <meta name="theme-color" content="#3a86ff">
    <!-- Add touch-icon for iOS home screen -->
    <link rel="apple-touch-icon" href="favicon.ico">
</head>
<body>
    <div class="container">
        <header>
            <h1>Echo Life</h1>
            <p class="app-tagline" data-i18n="app_tagline">Your voice, amplified by AI</p>
            
            <!-- Language and API controls row -->
            <div class="controls-container">
                <!-- Language controls container -->
                <div class="language-controls">
                    <!-- Language selector dropdown -->
                    <div class="language-selector-container">
                        <label for="languageSelector" class="sr-only">Select Language</label>
                        <select id="languageSelector" class="language-selector" aria-label="Select app language">
                            <option value="en-US">English</option>
                            <option value="pt-BR">PortuguÃªs Brasileiro</option>
                        </select>
                    </div>
                    
                    <!-- Translation toggle with improved tooltip -->
                    <div class="translation-toggle-container">
                        <label class="toggle-switch">
                            <input type="checkbox" id="translationToggle">
                            <span class="slider round"></span>
                        </label>
                        <span class="toggle-label" id="translationToggleLabel" data-i18n="auto_translate">Auto-translate</span>
                        <div class="tooltip-container">
                            <button class="tooltip-trigger" aria-label="Translation information">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <div class="tooltip-content" data-i18n="translate_tooltip">
                                When enabled, speech will be translated between languages.
                                When disabled, the original language will be preserved.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- API Key button with tooltip -->
                <div class="api-key-container">
                    <button id="editApiKeyButton" class="api-key-button">
                        <i class="fas fa-key"></i> <span data-i18n="edit_api_key">API Key</span>
                    </button>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="API key information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="api_key_tooltip">
                            An OpenAI API key is required for speech recognition and AI responses.
                            Your key is stored only on your device.
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <main>
            <!-- Info Banner for first-time users -->
            <div class="info-banner" id="firstTimeUserBanner">
                <div class="info-content">
                    <i class="fas fa-lightbulb info-icon"></i>
                    <p data-i18n="welcome_message">Welcome to Echo Life! Speak using the microphone button or upload audio to interact with AI.</p>
                </div>
                <button class="info-close" aria-label="Close information banner">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Word Cloud visualization with clearer indication -->
            <section class="word-cloud-section">
                <div class="section-header">
                    <h2 data-i18n="word_cloud">Topic Visualization</h2>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="Word cloud information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="word_cloud_tooltip">
                            This visualization shows key topics from your conversation.
                            Larger words are more relevant. Click the expand button to view fullscreen.
                        </div>
                    </div>
                </div>
                <div id="wordCloudContainer" class="word-cloud-container">
                    <div class="word-cloud-placeholder" data-i18n="words_appear">Words will appear as you speak...</div>
                    <button class="fullscreen-toggle" id="fullscreenToggle" aria-label="Toggle fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </section>
            
            <!-- Recording Section with better guidance -->
            <section class="recording-section">
                <div class="section-header">
                    <h2 data-i18n="record_audio">Record Audio</h2>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="Recording information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="recording_tooltip">
                            Click the microphone button to start/stop recording.
                            The recording will be processed automatically when you stop.
                            For iOS users: if recording fails, try the upload option below.
                        </div>
                    </div>
                </div>
                
                <div class="record-button-container">
                    <button id="recordButton" class="record-button" aria-label="Start recording">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <div id="recordingIndicator" class="recording-indicator hidden">
                        <div class="wave"></div>
                        <div class="wave"></div>
                        <div class="wave"></div>
                    </div>
                </div>
                <p id="recordingStatus" data-i18n="click_to_record">Click to start recording</p>
            </section>
            
            <!-- Audio drop area section with better explanation -->
            <section class="audio-drop-section">
                <div class="section-header">
                    <h2 data-i18n="upload_audio">Upload Audio</h2>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="Upload information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="upload_tooltip">
                            Drag and drop audio files or click to select.
                            WhatsApp voice messages work too! Recommended for iOS users.
                        </div>
                    </div>
                </div>
                
                <div id="audio-upload-placeholder"></div>
                
                <div class="upload-formats-info">
                    <p data-i18n="supported_formats">Supported formats: MP3, WAV, M4A, AAC, OPUS, OGG</p>
                    <p class="whatsapp-hint" data-i18n="whatsapp_hint">WhatsApp voice messages are fully supported.</p>
                </div>
            </section>
            
            <!-- Chat Section with clearer context -->
            <section class="chat-section">
                <div class="section-header">
                    <h2 data-i18n="ai_response">AI Response</h2>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="Chat information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="chat_tooltip">
                            After recording or uploading audio, you can get AI feedback by clicking the button below.
                            The AI will respond based on your speech content.
                        </div>
                    </div>
                </div>
                
                <div id="chatContainer" class="chat-container">
                    <!-- Chat messages will appear here -->
                    <div class="empty-chat-message" data-i18n="chat_empty">
                        <i class="fas fa-comment-dots empty-icon"></i>
                        <p>Your conversation will appear here after recording or uploading audio.</p>
                    </div>
                </div>
                
                <!-- Feedback button with tooltip -->
                <div class="feedback-button-container">
                    <button id="feedbackButton" class="feedback-button" disabled>
                        <i class="fas fa-comment-dots"></i> <span data-i18n="get_feedback">Get AI Feedback</span>
                    </button>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="Feedback information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="feedback_tooltip">
                            Click this button after recording or uploading audio to get AI feedback.
                            The button will be enabled once your speech has been processed.
                        </div>
                    </div>
                </div>
                
                <!-- Export options with better descriptions -->
                <div class="export-container">
                    <div class="section-header">
                        <h3 data-i18n="export_options">Export Options</h3>
                        <div class="tooltip-container">
                            <button class="tooltip-trigger" aria-label="Export information">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <div class="tooltip-content" data-i18n="export_tooltip">
                                Export your recording and transcription in various formats.
                                These options will be available after you record or upload audio.
                            </div>
                        </div>
                    </div>
                    
                    <div class="export-buttons">
                        <button id="exportTxtBtn" class="export-button" disabled>
                            <i class="fas fa-file-alt"></i> <span data-i18n="export_txt">Export Text</span>
                        </button>
                        <button id="exportSrtBtn" class="export-button" disabled>
                            <i class="fas fa-closed-captioning"></i> <span data-i18n="export_srt">Export Subtitles</span>
                        </button>
                        <button id="exportAudioBtn" class="export-button" disabled>
                            <i class="fas fa-file-audio"></i> <span data-i18n="export_audio">Export Audio</span>
                        </button>
                        <button id="exportVideoBtn" class="export-button" disabled>
                            <i class="fas fa-film"></i> <span data-i18n="export_video">Export for QuickTime</span>
                        </button>
                    </div>
                    
                    <!-- Subtitle Preview Player -->
                    <div id="subtitlePreviewContainer" class="subtitle-preview-container" style="display: none;">
                        <h4 data-i18n="subtitle_preview">Subtitle Preview</h4>
                        <div class="audio-player-container">
                            <audio id="previewAudioPlayer" controls></audio>
                            <div id="previewSubtitleDisplay" class="subtitle-display" data-i18n="subtitles_appear">
                                Subtitles will appear here during playback
                            </div>
                        </div>
                        <button id="closePreviewBtn" class="close-preview-button">
                            <i class="fas fa-times"></i> <span data-i18n="close_preview">Close Preview</span>
                        </button>
                    </div>
                    
                    <div class="preview-button-container">
                        <button id="previewSubtitlesBtn" class="preview-button" disabled>
                            <i class="fas fa-play-circle"></i> <span data-i18n="preview_subtitles">Preview with Subtitles</span>
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Tags Section with better explanation -->
            <section class="tag-section">
                <div class="section-header">
                    <h3 data-i18n="ai_tags">AI Response Tags</h3>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="Tags information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="tags_tooltip">
                            These tags show the key concepts the AI identified in its response.
                            Colors indicate confidence levels.
                        </div>
                    </div>
                </div>
                
                <div id="aiTagsContainer" class="tag-container">
                    <span class="tag-placeholder" data-i18n="tags_placeholder">Tags from AI responses will appear here</span>
                </div>
            </section>

            <!-- Audio history section with clearer context -->
            <section class="audio-history-section">
                <div class="section-header">
                    <h2 data-i18n="recent_audios">Recent Recordings</h2>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="History information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="history_tooltip">
                            Your recent recordings and uploads will be listed here.
                            Click on any item to reload it.
                        </div>
                    </div>
                </div>
                
                <div id="audioHistoryContainer" class="audio-history-container">
                    <!-- Recently uploaded audio files will appear here -->
                    <p class="empty-history-message" data-i18n="history_empty">Your recording history will appear here</p>
                </div>
            </section>
        </main>
        
        <footer>
            <p>&copy; 2023 Echo Life</p>
            
            <!-- Diagnostic tools section with better explanation -->
            <div class="diagnostic-tools">
                <div class="section-header">
                    <h3 data-i18n="diagnostics">Diagnostics</h3>
                    <div class="tooltip-container">
                        <button class="tooltip-trigger" aria-label="Diagnostics information">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="tooltip-content" data-i18n="diagnostics_tooltip">
                            Test your API connection to ensure Echo Life can access the required services.
                        </div>
                    </div>
                </div>
                
                <button id="testWhisperButton" class="diagnostic-button">
                    <i class="fas fa-microchip"></i> <span data-i18n="test_whisper">Test Whisper API</span>
                </button>
                <div id="testWhisperResult" class="diagnostic-result"></div>
            </div>
        </footer>
    </div>

    <!-- Scripts - Updated load order -->
    <script src="js/translations.js"></script>
    <script src="js/translation-controller.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/ios-speech.js"></script>
    <script src="js/transcription.js"></script>
    <script src="js/tag-extractor.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/audio-handler.js"></script>
    <script src="js/word-cloud.js"></script>
    <script src="js/tooltip.js"></script>
    <script src="js/app.js"></script>
    <script src="js/diagnostic-tools.js"></script>
</body>
</html>
